using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Microsoft.Scripting.Hosting;
using IronPython.Runtime;

namespace PyDoodle
{
    //-///////////////////////////////////////////////////////////////////////
    //-///////////////////////////////////////////////////////////////////////

    public class Attr
    {
        //-///////////////////////////////////////////////////////////////////////
        //-///////////////////////////////////////////////////////////////////////

        private pydoodleModule _module;
        private object _pyobj;
        private string _name;

        //-///////////////////////////////////////////////////////////////////////
        //-///////////////////////////////////////////////////////////////////////

        public EventHandler ValueSet;

        //-///////////////////////////////////////////////////////////////////////
        //-///////////////////////////////////////////////////////////////////////

        public pydoodleModule Module { get { return _module; } }
        public object Pyobj { get { return _pyobj; } }
        public string Name { get { return _name; } }

        //-///////////////////////////////////////////////////////////////////////
        //-///////////////////////////////////////////////////////////////////////

        public Attr(pydoodleModule module, object pyobj, string name)
        {
            _module = module;
            _pyobj = pyobj;
            _name = name;
        }

        //-///////////////////////////////////////////////////////////////////////
        //-///////////////////////////////////////////////////////////////////////

        public object GetValue()
        {
            return Module.ObjectOperations.GetMember(_pyobj, _name);
        }

        //-///////////////////////////////////////////////////////////////////////
        //-///////////////////////////////////////////////////////////////////////

        public void SilentSetValue(object value)
        {
            Module.ObjectOperations.SetMember(_pyobj, _name, value);
        }

        //-///////////////////////////////////////////////////////////////////////
        //-///////////////////////////////////////////////////////////////////////

        public void SetValue(object value)
        {
            SilentSetValue(value);

            OnValueSet();
        }

        //-///////////////////////////////////////////////////////////////////////
        //-///////////////////////////////////////////////////////////////////////

        protected void OnValueSet()
        {
            if (ValueSet != null)
                ValueSet(this, EventArgs.Empty);
        }

        //-///////////////////////////////////////////////////////////////////////
        //-///////////////////////////////////////////////////////////////////////

        public bool IsEquivalent(Attr rhs)
        {
            if (!object.ReferenceEquals(_pyobj, rhs._pyobj))
                return false;

            if (_name != rhs._name)
                return false;

            return true;
        }

        //-///////////////////////////////////////////////////////////////////////
        //-///////////////////////////////////////////////////////////////////////
    }
}
